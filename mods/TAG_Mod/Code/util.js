function tmCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function tmPrettyCash(e){return(e<0?"-":"")+"$"+tmCommas(e=Math.abs(e))}function tmPrettyCashHtml(e,t){var a=e<0;return t&&(a=!a),(a?'<span class="red">':'<span class="green">')+tmPrettyCash(e)+"</span>"}function tmPrettyDelta(e){return 0==e?"0":(e<0?"-":"+")+tmCommas(e=Math.abs(e))}function tmPrettyDeltaHtml(e,t){if(0==e)return"<span>0</span>";var a=e<0;return t&&(a=!a),(a?'<span class="red">':'<span class="green">')+tmPrettyDelta(e)+"</span>"}function htmlSmallDec(e,t){var a=Math.roundToDecimals(e,t).toString(),n=a.indexOf(".");return-1!=n?'<span class="tm-dec-big">'+a.substr(0,n+1)+'</span><span class="tm-dec-small">'+a.substr(n+1)+"</span>":a}function applyReviewCircle(e,t,a,n,l,i){null==a&&(a=!1),null==n&&(n=["#ed1c24","#f7941d"]),null==l&&(l=10);var r=2;100==l&&(r=0);var s=null,c=!1;null==t&&(a=!(t=0),s="?"),l<t&&(s=htmlSmallDec(t,r),t=10,c=!0);var o=e.find(".tagReviewCircleOuter").width(),d=e.find(".tagReviewRatingNum");function u(){c&&(n=["#d81b60","#ab47bc","#536dfe","#00e5ff","#00e676"],e.find(".tagReviewRating").append('<div class="tm-review-fancy"></div>'),e.find(".tm-review-fancy").circleProgress({value:t/l,animation:!1,size:.8*o,thickness:.12*o,startAngle:Math.PI/2,emptyFill:"rgba(0,0,0,0)",fill:{gradient:n,gradientAngle:Math.PI/4}}),a&&e.find(".tm-review-fancy").css("-webkit-transition","none"),setTimeout(function(){e.find(".tm-review-fancy").css("-webkit-transform","scale(1.02)")},0))}d.css("font-size",.018*o+"rem"),(a||i)&&d.html(null!=s?s:htmlSmallDec(t,r));var m=e.find(".tagReviewRating").circleProgress({value:t/l,animation:!0,size:.8*o,thickness:.12*o,startAngle:Math.PI/2,animation:a?null:{duration:800},emptyFill:"rgba(0,0,0,0)",fill:{gradient:n,gradientAngle:Math.PI/4}}).on("circle-animation-progress",function(e,t,a){i||d.html(htmlSmallDec(a*l,r))}).on("circle-animation-end",function(e,t,a){u()});return a&&u(),m}function generateReviewCircle(e,t,a,n,l,i){return e.empty().append('<div class="tagReviewCircleOuter" style="width:'+t+"px;height:"+t+'px;"> <div class="tagReviewRatingTrack"> <div class="tagReviewRatingNum">0</div><div class="tagReviewRating"></div> </div> </div>'),applyReviewCircle(e,a,n,l,i)}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}tagMod.dateToInt=function(e){return 12*(e.year-1)*4+4*(e.month-1)+e.week-1},tagMod.intToDate=function(e){return{year:Math.floor(e/48)+1,month:Math.floor(e%48/4)+1,week:e%4+1}},tagMod.dateToString=function(e,t){"number"==typeof e&&(e=tagMod.intToDate(e)),null==t&&(t="weekly");var a="";switch(t){case"yearly":a="Y{0}".localize("date display").format(e.year);break;case"monthly":a="Y{0} M{1}".localize("date display").format(e.year,e.month);break;default:a="Y{0} M{1} W{2}".localize("date display").format(e.year,e.month,e.week)}return a},tagMod.toPercent=function(e){return Math.round(100*e)+"%"},tagMod.patch=function(t,e,a,n){null==n&&(n=a,a=null);var l=t[e];t[e]=function(){null!=a&&a.apply(t,arguments);var e=l.apply(t,arguments);return null!=n&&n.apply(t,arguments),e}},tagMod.convertSelectItemContent=function(e){var t=e.text().trim(),a="cr.".localize("cr. short for credits"),n="RP".localize("RP short for research points"),l="{0}K".localize().format(""),i="{0}M".localize().format(""),r=new RegExp("^([^\\(]+)\\((([0-9]+) ?"+escapeRegExp(n)+",? ?)? ?(([0-9]+("+escapeRegExp(l)+"|"+escapeRegExp(i)+")?) ?("+escapeRegExp(a)+")?)?\\)$","i"),s=t.indexOf("Req."),c=null,o=null;if(-1!=s){var d=s-1,u="["==t.charAt(s-1)?t.indexOf("]"):t.indexOf(")"),m=t.substr(d,u-d+1);t=t.substr(0,d-1)+t.substr(u+1);for(var f=/(([DT]).?)?([0-9]+)(.?([DT]))?/gi,g=null;null!=(g=f.exec(m));){var p=g[2],v=parseInt(g[3]),h=g[5],b=p||h;null!=b&&("D"==b.toUpperCase()?c=v:o=v)}}var y=r.exec(t);if(null!=y){var M=y[1];null!=M&&(M=M.trim());var C=y[3],R=y[5],w=tagMod.getIconClassFromCategory(M);null!=w&&e.closest(".selectableGameFeatureItem").addClass(w+" tm-icon-bordered"),e.html('<div class="tm-select-content"><div class="tm-select-content-label">'+M+'</div><div class="tm-select-content-req"></div><div class="tm-select-content-cost"></div></div>');var z=e.find(".tm-select-content-req"),S=e.find(".tm-select-content-cost");null!=C&&S.append('<div class="tm-rp">'+C+"</div>"),null!=R&&S.append('<div class="tm-cr">'+R+"</div>"),null!=c&&null!=o?z.append("[Req. {0} / {1}]".localize().format('<span class="tm-d">'+c+"</span>",'<span class="tm-t">'+o+"</span>")):null!=c?z.append("[Req. {0}]".localize().format('<span class="tm-d">'+c+"</span>")):null!=o?z.append("[Req. {0}]".localize().format('<span class="tm-t">'+o+"</span>")):z.remove()}},tagMod.convertSelectItem=function(e){e.find(".selectionPip").remove(),e.find("div").each(function(){var e=$(this);0==e.text().indexOf("Effect: ".localize())&&e.remove()}),tagMod.convertSelectItemContent(e.find(".featureContent"))},tagMod.convertSelectList=function(e,n){if(null==n&&(n={}),e.find(".selectableGameFeatureItem").each(function(){tagMod.convertSelectItem($(this))}),e.find(".featureSelectionCategoryHeading").each(function(){var e=$(this);e.addClass(tagMod.getIconClassFromCategory(e.text().trim()))}),n.tabs){var t=$('<div class="tm-tabs"><ul class="tm-tabs-titles"></ul><div class="tm-tabs-content"></div></div>'),l=t.find(".tm-tabs-titles"),i=t.find(".tm-tabs-content"),r=null;e.find(".featureSelectionCategoryHeading, .selectableGameFeatureItem").each(function(){var e=$(this);if(e.hasClass("featureSelectionCategoryHeading")){var t=e.text().trim();function a(e){var t="tm-tab-"+GameManager.getGUID();l.append('<li><a href="#'+t+'">'+e+"</a></li>"),i.append('<div id="'+t+'" data-label="'+e+'" class="tm-tabs-content-item"></div>'),r=i.find("#"+t)}n.tabMerge&&null!=n.tabMerge[t]?(0==i.find(".tm-tabs-content-item[data-label='"+n.tabMerge[t]+"']").length&&a(n.tabMerge[t]),r.append(e)):(a(t),e.remove())}else null!=r&&r.append(e)}),e.append(t),t.tabs()}},tagMod.getHint=function(e){return 1<=e?"+++":.5<=e?"++":"+"},tagMod.getFriendlyStat=function(e){return Math.floor(500*e).toString()},tagMod.getFriendlyEfficiency=function(e){return Math.floor(100*e).toString()},tagMod.setupListDisplay=function(n,t,a,l,e){n.empty();for(var i=!0,r=0;r<a.length;r++){var s=a[r],c=null;null!=e&&!1===(c=e(s,r))||(null!==c&&!0!==c||(c=$('<div class="btn-tm-action btn-tm-action-light btn-tm-list-select'+(i?" selected":"")+'">'+s.name+"</div>")),function(a){c.click(function(e){var t=$(e.currentTarget);n.find(".btn-tm-list-select").removeClass("selected"),t.addClass("selected"),o(a)})}(s),n.append(c),i=!1)}function o(e){t.empty().append(l(e,a.indexOf(e)))}0<a.length&&o(a[0])},tagMod.setupSingleContainerListDisplay=function(e,t,a,n){e.empty().append('<div class="tm-list-select"><div class="tm-list-select-left"></div><div class="tm-list-select-right"><div class="tm-list-select-list"></div></div></div>'),tagMod.setupListDisplay(e.find(".tm-list-select-list"),e.find(".tm-list-select-left"),t,a,n)},tagMod.getGameTopicGenreString=function(e){return e.secondGenre?e.topic.name+"/"+e.genre.name+"-"+e.secondGenre.name:e.topic.name+"/"+e.genre.name},tagMod.getAverageGameScore=function(e){return e.reviews.average(function(e){return e.score})},tagMod.moveModal=function(e,t,a){(e=e.closest(".simplemodal-container")).css("left",parseFloat(e.css("left"))+t+"px"),e.css("top",parseFloat(e.css("top"))+a+"px")},tagMod.getConsoleGenerationString=function(e){switch(e.version){case 1:return"1st Generation".localize();case 2:return"2nd Generation".localize();case 3:return"3rd Generation".localize();default:return"{0}th Generation".localize().format(e.version)}},tagMod.getConsoleCost=function(e){var t=GDT.getDataStore("TAGMod").data;var a,n,l,i,r=(a=function(e,t,a,n){var l=(e/=n)*e,i=l*e;return t+a*(-.5*i*l+3*l*l+-3.5*i+2*l)},n=1,l=20,i=e.qF,n+(l-n)*a(i,0,1,1));r=Math.floor(r);var s=1e7+(r*=1e6);return null!=t.consoles&&null!=t.consoles[e.id]&&(s+=t.consoles[e.id].featureCost),s},tagMod.staffAvailableToWork=function(e){return e.state!=CharacterState.Researching&&e.state!=CharacterState.Training&&e.state!=CharacterState.Vacation},tagMod.getIconClassFromCategory=function(e){var t=null;switch(e){case"Engine".localize():t="engine";break;case"Gameplay".localize():t="gameplay";break;case"Story/Quests".localize():t="story";break;case"Dialogues".localize():t="dialogues";break;case"Level Design".localize():t="leveldesign";break;case"A.I.".localize():case"Artificial Intelligence".localize():t="ai";break;case"World Design".localize():t="worlddesign";break;case"Graphic".localize():t="graphics";break;case"Sound".localize():t="sound"}return null!=t?"tm-icon tm-icon-"+t:null};