$(function(){$("#reviewWindow").html('<div id="tagReviewWindow">'+'<div class="tagReviewSideContainer windowBorder"><div class="tagSideTitleBox windowTitle">{0}</div><div class="tagReviewAverageScore"> <div class="tagReviewCircleOuter"> <div class="tagReviewRatingTrack"> <div class="tagReviewRatingNum">0</div> <div class="tagReviewRating"></div> </div> </div> </div> <div class="tagReviewContinueButton btn-tm-action btn-tm-action-success">{1}</div> </div>'.format("Overall Score".localize(),"Continue".localize())+'<div class="tagReviewMainContainer windowBorder"><div class="tagVR"></div><div class="tagVR"></div><div class="tagVR"></div> <div class="tagReviewGameTitle windowTitle"><span> Reviews:</span></div><div class="tagReviewsContainer">  <div class="tagReviewItem tagReview1"> <div class="tagReviewCircleOuter"> <div class="tagReviewRatingTrack"> <div class="tagReviewRatingNum">0</div> <div class="tagReviewRating"></div> </div> </div> <div class="tagReviewMsg"></div> <div class="tagReviewReviewer"></div> </div><div class="tagVR" style="margin-left: 225.4px;"></div> <div class="tagReviewItem tagReview2"> <div class="tagReviewCircleOuter"> <div class="tagReviewRatingTrack"> <div class="tagReviewRatingNum">0</div><div class="tagReviewRating"></div> </div> </div> <div class="tagReviewMsg"></div> <div class="tagReviewReviewer"></div> </div> <div class="tagVR" style="margin-left: 450.8px;"></div> <div class="tagReviewItem tagReview3"> <div class="tagReviewCircleOuter"> <div class="tagReviewRatingTrack"><div class="tagReviewRatingNum">0</div> <div class="tagReviewRating"></div> </div> </div> <div class="tagReviewMsg"></div> <div class="tagReviewReviewer"></div> </div> <div class="tagVR" style="margin-left: 675.8px;"></div> <div class="tagReviewItem tagReview4"> <div class="tagReviewCircleOuter"> <div class="tagReviewRatingTrack"><div class="tagReviewRatingNum">0</div><div class="tagReviewRating"></div> </div> </div> <div class="tagReviewMsg"></div> <div class="tagReviewReviewer"></div></div></div></div></div>'),$("#reviewWindow").removeAttr("class"),$("#reviewItemTemplate").html('<div id="tagReviewItemTemplate" class="tagReviewItem"> <div class="tagReviewCircleOuter"> <div class="tagReviewRatingTrack"> <div class="score tagReviewRatingNum">0</div> <div class="tagReviewRating"></div> </div> </div> <div class="tagReviewMsg"></div> <div class="tagReviewReviewer"></div></div>'),$("#reviewItemTemplate").removeAttr("class"),UI.showReviewWindow=function(e,i){var a={disableCheckForNotifications:!0,onOpen:function(){d.animateReviews()},onClose:function(){GameManager.company.activeNotifications.remove(e),GDT.fire(GameManager,GDT.eventKeys.gameplay.reviewWindowClose,{company:GameManager.company})}};$("#reviewWindow").find(".tagReviewContinueButton").hide().clickExclOnce(function(){animationTweens=[],cssItems=[],UI.closeModal(i)}),UI.showModalContent("#reviewWindow",a)};var d={reviewSpeedModifier:1};$(window).on("click",function(){d.reviewSpeedModifier<3&&(d.reviewSpeedModifier=3)});d.animateReviewItem=function(e,i,a){var t=$("#tagReviewWindow").find(e),n=function(e,n){for(var i=0,v=GameManager.gameId,a=0;a<45;a++)!function(a,t){i+=a/4*20/d.reviewSpeedModifier,setTimeout(function(){if(v==GameManager.gameId){var e,i=(a+1)/45;e=1==i?n:(e=n+9*Math.random()*(1-i)*Math.randomSign(),Math.floor(e).clamp(1,10)),parseInt(t.find(".tagReviewRatingNum").text())!=e&&Sound.playSoundOnce("reviewTack",.15),t.find(".tagReviewRatingNum").text(e)}},i)}(a,e);return i+=300/d.reviewSpeedModifier}(t,i.score);setTimeout(function(){applyReviewCircle(t,i.score,null,null,null,!0).on("circle-animation-end",function(e){t.find(".tagReviewMsg").text(i.message).typewrite({delay:20,soundLoop:"notificationTyping",volume:.12,callback:function(){t.find(".tagReviewReviewer").text("- "+i.reviewerName).typewrite({delay:20,wait:200,soundLoop:"notificationTyping",volume:.12,callback:function(){a&&a()}})}})})},n)},d.animateAverageScore=function(i){var e=GameManager.company.gameLog.last().reviews.average(function(e){return e.score});applyReviewCircle($("#tagReviewWindow").find(".tagReviewAverageScore"),e).on("circle-animation-end",function(e){i&&i()})},d.animateReviews=function(){d.reviewSpeedModifier=1,GDT.getDataStore("TAGMod").settings["insta-reviews"]&&(d.reviewSpeedModifier=300);var e=$("#tagReviewWindow"),i=GameManager.company.gameLog.last().reviews;e.find(".tagReviewGameTitle").html(GameManager.company.gameLog.last().title+" Reviews:"),e.find(".tagReviewsContainer").empty(),e.find(".tagVR").hide(),e.find(".tagReviewSideContainer").hide(),e.find(".tagReviewSideContainer").css("right","250px");var a=$("#tagReviewItemTemplate").clone(),t=$("#tagReviewItemTemplate").clone(),n=$("#tagReviewItemTemplate").clone(),v=$("#tagReviewItemTemplate").clone();a.attr("style","margin-left: -120px; opacity: 0; z-index: 10;"),t.attr("style","margin-left: -120px; opacity: 0; z-index: 9;"),n.attr("style","margin-left: -120px; opacity: 0; z-index: 8;"),v.attr("style","margin-left: -120px; opacity: 0; z-index: 7;"),a.addClass("tagReview1").addClass("tagReview"),t.addClass("tagReview2").addClass("tagReview"),n.addClass("tagReview3").addClass("tagReview"),v.addClass("tagReview4").addClass("tagReview"),e.find(".tagReviewsContainer").append(a),e.find(".tagReviewsContainer").append(t),e.find(".tagReviewsContainer").append(n),e.find(".tagReviewsContainer").append(v),e.find(".tagReview").hide(),e.find(".tagReview1").show(),e.find(".tagReview1").animate({marginLeft:"0px",opacity:1},600/d.reviewSpeedModifier,"ease-in",function(){e.find(".tagVR").eq(0).fadeIn(),d.animateReviewItem(".tagReview1",i[0],function(){e.find(".tagReview2").show(),e.find(".tagReview2").animate({marginLeft:"0px",opacity:1},600/d.reviewSpeedModifier,"ease-in",function(){e.find(".tagVR").eq(1).fadeIn(),d.animateReviewItem(".tagReview2",i[1],function(){e.find(".tagReview3").show(),e.find(".tagReview3").animate({marginLeft:"0px",opacity:1},600/d.reviewSpeedModifier,"ease-in",function(){e.find(".tagVR").eq(2).fadeIn(),d.animateReviewItem(".tagReview3",i[2],function(){e.find(".tagReview4").show(),e.find(".tagReview4").animate({marginLeft:"0px",opacity:1},600/d.reviewSpeedModifier,"ease-in",function(){d.animateReviewItem(".tagReview4",i[3],function(){e.find(".tagReviewSideContainer").show(),e.find(".tagReviewSideContainer").animate({right:"0px"},600/d.reviewSpeedModifier,function(){d.animateAverageScore(function(){e.find(".tagReviewContinueButton").fadeIn()})})})})})})})})})})}});