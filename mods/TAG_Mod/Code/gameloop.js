$(function(){var f=null;function h(){null!=f&&GameManager.company==f||null==GameManager.company||(f=GameManager.company)}function M(){var e=GDT.getDataStore("TAGMod").data;return void 0===e.revenue&&(e.revenue=[]),e}function a(e,t,a){var n,l,r=M(),u=(n=e,l=t,M().revenue.find(function(e){return tagMod.dateToInt(e.date)==tagMod.dateToInt(f.getCurrentDate())&&e.type==n&&e.id==l}));null!=u&&r.revenue.remove(u),r.revenue.push({date:f.getCurrentDate(),type:e,id:t,value:a})}function l(e,t){if(h(),null==f)return[];var a=M();"string"==typeof e&&(e=[e]),null==t&&(t={});var n=1,l=null,r=null;if(null!=t.granularity)switch(t.granularity){case"monthly":n=4;break;case"yearly":n=48}null!=t.start&&(l=tagMod.dateToInt(t.start),l=Math.floor(l/n)*n),null!=t.end&&(r=tagMod.dateToInt(t.end),r=Math.floor(r/n)*n+n-1);for(var u=[],o=0;o<e.length;o++){for(var g=e[o],s={lastDate:-1,n:0,value:0,total:0},d=0;d<a.revenue.length;d++){var v=a.revenue[d],i=tagMod.dateToInt(v.date);v.type==g&&(null==t.id||v.id==id)&&(null==l||l<=i)&&(null==r||i<=r)&&(-1!=s.lastDate&&Math.floor(i/n)!=Math.floor(s.lastDate/n)&&("average"==t.aggregation?u.push({date:tagMod.intToDate(s.lastDate),value:s.value/s.n}):u.push({date:tagMod.intToDate(s.lastDate),value:s.value}),s={lastDate:-1,n:0,value:0,total:0}),s.lastDate=i,s.value+=v.value,s.n++)}-1!=s.lastDate&&("average"==t.aggregation?u.push({date:tagMod.intToDate(s.lastDate),value:s.value/s.n}):u.push({date:tagMod.intToDate(s.lastDate),value:s.value}))}return u}function e(e,t){if(h(),null==f)return 0;null==t&&(t={});var a=tagMod.intToDate(tagMod.dateToInt(f.getCurrentDate())-4);t.start=a,t.end=a,t.granularity="monthly";var n=l(e,t);return 0<n.length?n[0].value:0}function t(e,t){if(h(),null==f)return 0;null==t&&(t={});var a=f.getCurrentDate();t.start=a,t.end=a,t.granularity="monthly";var n=l(e,t);return 0<n.length?n[0].value:0}function n(){!function(){for(var e=0;e<f.gameLog.length;e++){var t=f.gameLog[e];t.isOnSale()&&0<t.salesCashLog.length&&a("game.sales",t.id,t.salesCashLog.last())}}(),function(){for(var e=0;e<f.licencedPlatforms.length;e++){var t=f.licencedPlatforms[e];t.isCustom&&!t.soldOut&&0<t.salesCashLog.length&&a("console.sales",t.id,t.salesCashLog.last())}}()}function r(){!function(){for(var e=0,t=0;t<f.staff.length;t++)f.staff[t],e+=f.staff[t].salary;a("staff.salary",null,e)}(),a("rnd.budget",null,null!=f.flags.rndBudget?f.flags.rndBudget*GameManager.MAX_RND_COST:0),a("hardware.budget",null,null!=f.flags.hwBudget?f.flags.hwBudget*GameManager.MAX_HW_COST:0),f.tmMonthlyRevenue=e(["game.sales"])+e(["console.sales"]),f.tmMonthlyCost=General.getMonthlyCosts(f)+t(["rnd.budget"])+t(["hardware.budget"]),a("revenue",null,f.tmMonthlyRevenue),a("cost",null,f.tmMonthlyCost)}GDT.on(GDT.eventKeys.saves.loading,h),GDT.on(GDT.eventKeys.gameplay.weekProceeded,function(){n(),1==f.getCurrentDate().week&&r(),1==f.getCurrentDate().month&&f.getCurrentDate().week}),tagMod.queryStat=l,tagMod.queryStatPrevMonth=e,tagMod.queryStatMonth=t});