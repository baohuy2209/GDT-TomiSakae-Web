!function(){var e;tagMod.patch(UI,"showFeatureList",function(e,t){var a=$("#simplemodal-container");a.hasClass("smallScreenPopup")&&tagMod.moveModal(a,5,0);var r=GameManager.company.currentGame,n=$("#selectFeatureMenu #selectFeatureMenuTemplate");$("#selectFeatureMenuTemplate .featureWindowTitle").remove(),$("#selectFeatureMenuTemplate .gameName").remove(),$("#selectFeatureMenuTemplate .topicGenre").remove(),n.prepend("<hr>"),n.prepend('<div class="tagDevScreenStageContainer"><div id="tagDevScreenStage1" class="tagDevScreenStage">Stage 1</div><div id="tagDevScreenStage2" class="tagDevScreenStage">Stage 2</div><div id="tagDevScreenStage3" class="tagDevScreenStage">Stage 3</div></div>'),1==GameManager.getCurrentDevStage()?($("#selectFeatureMenu #selectFeatureMenuTemplate #tagDevScreenStage1").addClass("tagDevScreenCurrentStage"),$("#selectFeatureMenu #selectFeatureMenuTemplate #tagDevScreenStage2").removeClass("tagDevScreenCurrentStage"),$("#selectFeatureMenu #selectFeatureMenuTemplate #tagDevScreenStage3").removeClass("tagDevScreenCurrentStage")):2==GameManager.getCurrentDevStage()?($("#selectFeatureMenu #selectFeatureMenuTemplate #tagDevScreenStage1").removeClass("tagDevScreenCurrentStage"),$("#selectFeatureMenu #selectFeatureMenuTemplate #tagDevScreenStage2").addClass("tagDevScreenCurrentStage"),$("#selectFeatureMenu #selectFeatureMenuTemplate #tagDevScreenStage3").removeClass("tagDevScreenCurrentStage")):($("#selectFeatureMenu #selectFeatureMenuTemplate #tagDevScreenStage1").removeClass("tagDevScreenCurrentStage"),$("#selectFeatureMenu #selectFeatureMenuTemplate #tagDevScreenStage2").removeClass("tagDevScreenCurrentStage"),$("#selectFeatureMenu #selectFeatureMenuTemplate #tagDevScreenStage3").addClass("tagDevScreenCurrentStage")),n.prepend("<hr>"),n.prepend('<div class="tagDevScreenInfo"></div>');var s=n.find(".tagDevScreenInfo");r.secondGenre?s.prepend('<div class="tagDevScreenTopicGenre tagGenLightText">'+r.topic.name+"/"+r.genre.name+"-"+r.secondGenre.name+"</div>"):s.prepend('<div class="tagDevScreenTopicGenre tagGenLightText">'+r.topic.name+"/"+r.genre.name+"</div>"),s.prepend('<div class="tagDevScreenGameName tagGenDarkText">'+"Development".localize()+": <b>"+r.title+"</b></div>"),n.find(".focusSliderWrapper").each(function(){var e="{0} Lvl. {1}".localize("{0} feature name, {1} lvl number").format("a","a");e=e.substr(1,e.length-3);var t=$(this).find(".focusSliderTitle");t.text(t.text().substr(0,t.text().indexOf(e))),t.insertAfter($(this).find(".focusSliderHint")),$('<div class="tagFocusSliderAmount"></div>').insertAfter($(this).find(".focusSliderHint"))}),n.find(".featureDurationPreview").html('<div class="tagFeatureFocusPercent"></div>'),$("#selectFeatureMenu #selectFeatureMenuTemplate").find(".featureSelectionPanel .cost").html('<div class="tagCostCost">{0}</div><div class="tagFeatureCost">{1}</div>'.format("Cost: ".localize(),UI.getShortNumberString(UI._getGameFeatureCosts()))),$("#selectFeatureMenu").find(".featureSelectionPanel").find(".selectableGameFeatureItem").click(function(){$("#selectFeatureMenu #selectFeatureMenuTemplate").find(".featureSelectionPanel .cost").html('<div class="tagCostCost">{0}</div><div class="tagFeatureCost">{1}</div>'.format("Cost: ".localize(),UI.getShortNumberString(UI._getGameFeatureCosts())))}),tagMod.convertSelectList($("#selectFeatureMenu .featureSelectionContainer")),$("#selectFeatureMenu").find(".featureSelectionPanel").find(".windowTitle").html('<img class="tagFatCheckmarkIcon" src="'+MOD_DIR+'Img/SVG/tag-fatCheckmark.svg"><span style="margin-left: 8px; ">{0}</span>'.format("Features".localize())),$("#selectFeatureMenu").find(".featureStaffAsignPanel").find(".windowTitle").html('<img class="tagFatCheckmarkIcon" src="'+MOD_DIR+'Img/SVG/tag-staffTrans.svg"><span style="margin-left: 8px; ">{0}</span>'.format("Staff".localize())),UI._updateFeatureFocusPreview(),setTimeout(l,100)}),e=UI._updateFeatureFocusPreview,UI._updateFeatureFocusPreview=function(){e(),$("#selectFeatureMenu #selectFeatureMenuTemplate").find(".focusSliderWrapper").each(function(){var e=$(this).find(".tagFocusSliderAmount");$(this).hasClass("feature1")?e.html(UI._getSelectedSliderValues()[0].toString()+"%"):$(this).hasClass("feature2")?e.html(UI._getSelectedSliderValues()[1].toString()+"%"):$(this).hasClass("feature3")&&e.html(UI._getSelectedSliderValues()[2].toString()+"%")}),$("#selectFeatureMenu #selectFeatureMenuTemplate").find(".featureDurationPreview").each(function(){var e=$(this).find(".tagFeatureFocusPercent");$(this).hasClass("featurePreview1")?e.html(Math.roundToDecimals(UI._getSelectedFeaturePercentages()[0],1).toString()+"%"):$(this).hasClass("featurePreview2")?e.html(Math.roundToDecimals(UI._getSelectedFeaturePercentages()[1],1).toString()+"%"):$(this).hasClass("featurePreview3")&&e.html(Math.roundToDecimals(UI._getSelectedFeaturePercentages()[2],1).toString()+"%")}),l()};var n=[];function l(){$("#selectFeatureMenu .staffListItem .workload").each(function(){var e=$(this),t=((parseInt(e.find(".responsibility").text().replace("%",""))-100)/50).clamp(0,1),a=createjs.Graphics.getHSL(168-175*t,76+16*t,36+-2*t),r=createjs.Graphics.getHSL(146-126*t,61+39*t,59+-9*t);n.push({$el:e,topColor:r,bottomColor:a})})}GameManager.addTickListener(function(){if(0!=n.length){for(var e=0;e<n.length;e++){var t=n[e];t.$el.css("background-image","linear-gradient(to bottom, "+t.topColor+" 0%, "+t.bottomColor+" 100%)")}n=[]}},!1),tagMod.patch(UI,"_updateStaffListForFeatures",function(){for(var e=GameManager.company,t=$(".simplemodal-data").find(".staffListContainer"),a=e.staff,r=0;r<a.length;r++){var n=a[r],s=tagMod.buildStaffItem(n),l=t.find(".staffListItem").slice(r,r+1);l.removeClass("staffItemBorder"),l.find(".specialization, .staffName, .pointsDisplayContainer, .workloadTrack").remove(),l.append(s),s.find(".tm-staff-item-name").addClass("staffName");var i=s.find(".tm-staff-item-bar"),c=l.find(".responsibility"),u=l.find(".workload");c.addClass("tm-staff-item-bar-inner"),u.append(c),i.empty().append(u)}}),$("body").on("drop",".focusSliderWrapper",function(){l()}),tagMod.patch(UI,"featuresSelectedClick",function(){var e=GameManager.getCurrentDevStage(),t=UI.getDevStageSliderValues(GameManager.getCurrentDevStage()),a=GameManager.company.currentGame;null==a.flags.tmSliderPercentages&&(a.flags.tmSliderPercentages={}),a.flags.tmSliderPercentages["stage"+e]=t.slice()})}();